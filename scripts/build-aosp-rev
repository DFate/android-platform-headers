#/bin/sh

if [ "$1" == "" ]; then
    echo "Usage: $0 <tag>"
    exit 1
fi

TAG=$1
set -xe

if [ ! -d "$TAG" ]; then
    ./fetch-aosp-rev $TAG
    if [ -d patches/$TAG ]; then
        cd $TAG
        for patch in ../patches/$TAG/*; do
            patch -p1 -N -i $patch
        done
        cd ..
    fi
fi

cd $TAG

rm -rf out
. build/envsetup.sh
lunch generic-eng
make am showcommands HOST_CC=gcc-4.4 HOST_CXX=g++-4.4 HOST_CPP=cpp-4.4
